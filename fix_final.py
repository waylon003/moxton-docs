"""
最终修复脚本 - 修复特定的不完整中文字符串
"""

import re

def fix_specific_issues(content):
    """修复特定的不完整字符串"""

    replacements = [
        # 购物车状态相关
        ('购物车状\n', '购物车状态\n'),
        ('购物车状\r\n', '购物车状态\r\n'),
        ('最新购物车状\n', '最新购物车状态\n'),
        ('最新购物车状\r\n', '最新购物车状态\r\n'),
        ('购物车状态态', '购物车状态'),

        # 问题相关
        ('避免数据不一致问\n', '避免数据不一致问题\n'),
        ('避免数据不一致问\r\n', '避免数据不一致问题\r\n'),
        ('避免数据不一致问题题', '避免数据不一致问题'),

        # 概述相关
        ('购物车概\n', '购物车概述\n'),
        ('购物车概\r\n', '购物车概述\r\n'),
        ('购物车概述述', '购物车概述'),

        # 支持相关
        ('购物车模块支**游客模式***登录用户模式**', '购物车模块支持**游客模式**和**登录用户模式**'),
        ('购物车模块支持持', '购物车模块支持'),

        # 特性相关
        ('核心特*:', '核心特性:'),
        ('核心特性性:', '核心特性:'),
        ('**核心特*:', '**核心特性:'),
        ('**核心特性性:', '**核心特性:'),

        # 购物车相关
        ('游客购物*: ', '游客购物车：'),
        ('游客购物车：:', '游客购物车：'),
        ('**游客购物*:', '**游客购物车：'),
        ('**游客购物车：:', '**游客购物车：'),

        ('登录用户购物*: ', '登录用户购物车：'),
        ('登录用户购物车：:', '登录用户购物车：'),
        ('**登录用户购物*:', '**登录用户购物车：'),
        ('**登录用户购物车：:', '**登录用户购物车：'),

        # 识别相关
        ('通过X-Guest-ID头识\n', '通过X-Guest-ID头识别\n'),
        ('通过X-Guest-ID头识别别', '通过X-Guest-ID头识别'),
        ('通过X-Guest-ID头识\r\n', '通过X-Guest-ID头识别\r\n'),

        # 其他常见问题
        ('**核心特性:', '**核心特性**:'),
        ('**游客购物车：', '**游客购物车**：'),
        ('**登录用户购物车：', '**登录用户购物车**：'),
        ('购物0天后', '购物车 30 天后'),
        ('（可选', '（可选）'),
        ('（推荐', '（推荐）'),
        ('身份标', '身份标识'),
        ('购物车采*计算属性模*', '购物车采用计算属性模式'),
        ('购物车采用计算属性模式式', '购物车采用计算属性模式'),
        ('购物车响\n', '购物车响应\n'),
        ('购物车响应应', '购物车响应'),
        ('保持一\n', '保持一致\n'),
        ('保持一致致', '保持一致'),
        ('推荐\n', '推荐）\n'),
        ('推荐\r\n', '推荐）\r\n'),
        ('可选\n', '可选）\n'),
        ('可选\r\n', '可选）\r\n'),

        # 更多问题
        ('解决的问\n', '解决的问题\n'),
        ('解决的问\r\n', '解决的问题\r\n'),
        ('解决的问题题', '解决的问题'),
        ('价格不同步问**\n', '价格不同步问题**\n'),
        ('价格不同步问**\r\n', '价格不同步问题**\r\n'),
        ('价格不同步问题题**', '价格不同步问题**'),
        ('**价格不同步问**', '**价格不同步问题**'),
        ('价格快\n', '价格快照\n'),
        ('价格快\r\n', '价格快照\r\n'),
        ('价格快照照', '价格快照'),
        ('金额错\n', '金额错误\n'),
        ('金额错\r\n', '金额错误\r\n'),
        ('金额错误误', '金额错误'),

    ]

    result = content
    for old, new in replacements:
        result = result.replace(old, new)

    return result

# 处理文件
files_to_fix = [
    '02-api/addresses.md',
    '02-api/cart.md',
    '02-api/notifications.md',
    '02-api/offline-orders.md',
    '02-api/products.md',
    '02-api/upload.md',
]

for filepath in files_to_fix:
    print(f'Processing: {filepath}')

    with open(filepath, 'r', encoding='utf-8') as f:
        content = f.read()

    # 应用修复
    fixed_content = fix_specific_issues(content)

    # 检查是否有变化
    if content != fixed_content:
        with open(filepath, 'w', encoding='utf-8', newline='\r\n') as f:
            f.write(fixed_content)
        print(f'  Updated')
    else:
        print(f'  No changes needed')

print('\nDone!')
